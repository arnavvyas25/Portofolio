<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Patient Risk Assessment | Arnav Vyas</title>

    <!-- Bootstrap + Fonts -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;700&display=swap" rel="stylesheet"/>

    <style>
        :root {
            --accent:#ff6f61;
            --bg-dark:#1a1a2e;
            --text-dark:#eaeaea;
            --bg-light:#f8f9fa;
            --text-light:#333;
        }

        body {
            font-family:'Montserrat',sans-serif;
            background:var(--bg-dark);
            color:var(--text-dark);
            transition:background .3s,color .3s;
        }

        body.light-mode {
            background:var(--bg-light);
            color:var(--text-light);
        }

        .navbar {
            background:rgba(26,26,46,.9);
            backdrop-filter:blur(10px);
        }

        body.light-mode .navbar {
            background:rgba(248,249,250,.9);
        }

        .navbar-brand,.nav-link {
            color:var(--text-dark)!important;
            font-weight:bold;
        }

        body.light-mode .navbar-brand,
        body.light-mode .nav-link {
            color:var(--text-light)!important;
        }

        .section-card {
            background:#0f3460;
            border-radius:12px;
            padding:2.5rem;
            margin:4rem auto;
            max-width:700px;
            box-shadow:0 4px 20px rgba(0,0,0,.3);
        }

        body.light-mode .section-card {
            background:#fff;
            color:#333;
        }

        h1 {
            color:var(--accent);
            margin-bottom:1.5rem;
        }

        .form-label {
            font-weight:bold;
        }

        .btn-accent {
            background:var(--accent);
            color:#fff;
            border:none;
        }

        .btn-accent:hover {
            background:#e85a4f;
        }

        .result-box {
            margin-top:2rem;
            padding:1.5rem;
            border-radius:10px;
            display:none;
        }

        .result-low {
            background:rgba(40,167,69,.15);
            border-left:6px solid #28a745;
        }

        .result-high {
            background:rgba(220,53,69,.15);
            border-left:6px solid #dc3545;
        }

        .error-box {
            margin-top:1.5rem;
            color:#dc3545;
            display:none;
        }

        .dark-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            z-index: 2000;
        }
    </style>
</head>

<body>

<button class="dark-toggle">â˜€</button>

<nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
        <a class="navbar-brand" href="index.html">Arnav Vyas</a>
    </div>
</nav>

<main>
    <section class="section-card">
        <h1>Patient Risk Assessment</h1>
        <p>
            This tool demonstrates a cloud-deployed ML inference service.
            Inputs are sent to a backend API running in a containerized,
            autoscaled environment.
        </p>

        <form id="riskForm">
            <div class="mb-3">
                <label class="form-label">Age</label>
                <input type="number" class="form-control" id="age" required min="0">
            </div>

            <div class="mb-3">
                <label class="form-label">Creatinine (mg/dL)</label>
                <input type="number" class="form-control" id="creatinine" required step="0.01" min="0">
            </div>

            <div class="mb-3">
                <label class="form-label">Systolic Blood Pressure (mmHg)</label>
                <input type="number" class="form-control" id="bp" required min="0">
            </div>

            <button type="submit" class="btn btn-accent w-100">
                Assess Risk
            </button>
        </form>

        <div id="result" class="result-box"></div>
        <div id="error" class="error-box"></div>
    </section>
</main>

<script>
/*
===========================================
CONFIG
===========================================
Change this to your deployed API later
*/
const API_URL = "http://localhost:8000/predict";

/*
===========================================
FORM HANDLING
===========================================
*/
document.getElementById("riskForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const resultBox = document.getElementById("result");
    const errorBox = document.getElementById("error");

    resultBox.style.display = "none";
    errorBox.style.display = "none";

    const payload = {
        age: Number(document.getElementById("age").value),
        creatinine: Number(document.getElementById("creatinine").value),
        systolic_bp: Number(document.getElementById("bp").value)
    };

    try {
        const response = await fetch(API_URL, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            throw new Error("API request failed");
        }

        const data = await response.json();

        resultBox.className = "result-box " +
            (data.risk_level === "high" ? "result-high" : "result-low");

        resultBox.innerHTML = `
            <h5>Risk Assessment Result</h5>
            <p><strong>Risk Score:</strong> ${data.risk_score}</p>
            <p><strong>Risk Level:</strong> ${data.risk_level.toUpperCase()}</p>
        `;

        resultBox.style.display = "block";

    } catch (err) {
        errorBox.innerText =
            "Unable to reach the risk assessment service. Please try again later.";
        errorBox.style.display = "block";
    }
});

/*
===========================================
DARK MODE TOGGLE
===========================================
*/
document.querySelector(".dark-toggle").addEventListener("click", e => {
    document.body.classList.toggle("light-mode");
    e.target.textContent =
        document.body.classList.contains("light-mode") ? "ðŸŒ™" : "â˜€";
});
</script>

</body>
</html>
