<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Patient Risk Assessment | Arnav Vyas</title>

    <!-- Bootstrap + Fonts -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;700&display=swap" rel="stylesheet"/>

    <style>
        :root {
            --accent:#ff6f61;
            --bg-dark:#1a1a2e;
            --text-dark:#eaeaea;
            --bg-light:#f8f9fa;
            --text-light:#333;
        }

        body {
            font-family:'Montserrat',sans-serif;
            background:var(--bg-dark);
            color:var(--text-dark);
            transition:background .3s,color .3s;
        }

        body.light-mode {
            background:var(--bg-light);
            color:var(--text-light);
        }

        .navbar {
            background:rgba(26,26,46,.9);
            backdrop-filter:blur(10px);
        }

        body.light-mode .navbar {
            background:rgba(248,249,250,.9);
        }

        .navbar-brand,.nav-link {
            color:var(--text-dark)!important;
            font-weight:bold;
        }

        body.light-mode .navbar-brand,
        body.light-mode .nav-link {
            color:var(--text-light)!important;
        }

        .section-card {
            background:#0f3460;
            border-radius:12px;
            padding:2.5rem;
            margin:4rem auto;
            max-width:700px;
            box-shadow:0 4px 20px rgba(0,0,0,.3);
        }

        body.light-mode .section-card {
            background:#fff;
            color:#333;
        }

        h1 {
            color:var(--accent);
            margin-bottom:1.5rem;
        }

        .form-label {
            font-weight:bold;
        }

        .btn-accent {
            background:var(--accent);
            color:#fff;
            border:none;
        }

        .btn-accent:hover {
            background:#e85a4f;
        }

        .result-box {
            margin-top:2rem;
            padding:1.5rem;
            border-radius:10px;
            display:none;
        }

        .result-low {
            background:rgba(40,167,69,.15);
            border-left:6px solid #28a745;
        }

        .result-high {
            background:rgba(220,53,69,.15);
            border-left:6px solid #dc3545;
        }

        .error-box {
            margin-top:1.5rem;
            color:#dc3545;
            display:none;
        }

        .dark-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            z-index: 2000;
        }

        /* Phase section styles */
        .phase-item {
            margin-bottom: 1.75rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        body.light-mode .phase-item {
            border-bottom-color: rgba(0,0,0,0.1);
        }

        .phase-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .phase-title {
            color: var(--accent);
            font-weight: 700;
            margin-bottom: 0.75rem;
        }

        .phase-list {
            margin: 0;
            padding-left: 1.25rem;
            line-height: 1.8;
        }

        .phase-list li {
            margin-bottom: 0.4rem;
        }

        .phase-list code {
            background: rgba(255,111,97,0.15);
            color: var(--accent);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        body.light-mode .phase-list code {
            background: rgba(255,111,97,0.2);
        }

        .k8s-section {
            margin-top: 0.75rem;
            margin-left: 0.5rem;
        }

        .k8s-section strong {
            color: #aaa;
        }

        body.light-mode .k8s-section strong {
            color: #555;
        }
    </style>
</head>

<body>

<button class="dark-toggle">â˜€</button>

<nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
        <a class="navbar-brand" href="index.html">Arnav Vyas</a>
    </div>
</nav>

<main>
    <section class="section-card">
        <h1>Patient Risk Assessment</h1>
        <p>
            This tool demonstrates a cloud-deployed ML inference service.
            Inputs are sent to a backend API running in a containerized,
            autoscaled environment.
        </p>

        <form id="riskForm">
            <div class="mb-3">
                <label class="form-label">Age</label>
                <input type="number" class="form-control" id="age" required min="0">
            </div>

            <div class="mb-3">
                <label class="form-label">Creatinine (mg/dL)</label>
                <input type="number" class="form-control" id="creatinine" required step="0.01" min="0">
            </div>

            <div class="mb-3">
                <label class="form-label">Systolic Blood Pressure (mmHg)</label>
                <input type="number" class="form-control" id="bp" required min="0">
            </div>

            <button type="submit" class="btn btn-accent w-100">
                Assess Risk
            </button>
        </form>

        <div id="result" class="result-box"></div>
        <div id="error" class="error-box"></div>
    </section>

    <section class="section-card">
        <h2 style="color:var(--accent);margin-bottom:1.5rem;">How It Was Built</h2>

        <div class="phase-item">
            <h5 class="phase-title">Phase 1: ML Model Development</h5>
            <ul class="phase-list">
                <li>Created a simple risk prediction model (<code>model.py</code>) using weighted linear combination of patient vitals</li>
                <li>Normalized output to 0-1 range for risk scoring</li>
            </ul>
        </div>

        <div class="phase-item">
            <h5 class="phase-title">Phase 2: API Development</h5>
            <ul class="phase-list">
                <li>Built FastAPI application with two endpoints:
                    <ul>
                        <li><code>POST /predict</code> â€“ accepts patient data, returns risk score</li>
                        <li><code>GET /health</code> â€“ health check for Kubernetes probes</li>
                    </ul>
                </li>
                <li>Defined Pydantic model (<code>PatientInput</code>) for input validation</li>
                <li>Configured CORS middleware for specific allowed origins</li>
            </ul>
        </div>

        <div class="phase-item">
            <h5 class="phase-title">Phase 3: Containerization</h5>
            <ul class="phase-list">
                <li>Created Dockerfile using <code>python:3.10-slim</code> base image</li>
                <li>Set up working directory and copied requirements</li>
                <li>Installed dependencies and exposed port 8000</li>
                <li>Configured Uvicorn as the ASGI server</li>
            </ul>
        </div>

        <div class="phase-item">
            <h5 class="phase-title">Phase 4: Kubernetes Deployment</h5>
            <div class="k8s-section">
                <strong>Deployment</strong> (<code>deployment.yaml</code>)
                <ul class="phase-list">
                    <li>2 replica pods for high availability</li>
                    <li>Resource limits (100mâ€“500m CPU)</li>
                    <li>Local image pull policy for development</li>
                </ul>
            </div>
            <div class="k8s-section">
                <strong>Service</strong> (<code>service.yaml</code>)
                <ul class="phase-list">
                    <li>NodePort service type for external access</li>
                    <li>Port mapping 80 â†’ 8000</li>
                </ul>
            </div>
            <div class="k8s-section">
                <strong>HPA</strong> (<code>hpa.yaml</code>)
                <ul class="phase-list">
                    <li>Auto-scaling between 2â€“5 replicas</li>
                    <li>CPU utilization target of 50%</li>
                </ul>
            </div>
        </div>
    </section>
</main>

<script>
/*
===========================================
CONFIG
===========================================
Change this to your deployed API later
*/
const API_URL = "http://localhost:8000/predict";

/*
===========================================
FORM HANDLING
===========================================
*/
document.getElementById("riskForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const resultBox = document.getElementById("result");
    const errorBox = document.getElementById("error");

    resultBox.style.display = "none";
    errorBox.style.display = "none";

    const payload = {
        age: Number(document.getElementById("age").value),
        creatinine: Number(document.getElementById("creatinine").value),
        systolic_bp: Number(document.getElementById("bp").value)
    };

    try {
        const response = await fetch(API_URL, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            throw new Error("API request failed");
        }

        const data = await response.json();

        resultBox.className = "result-box " +
            (data.risk_level === "high" ? "result-high" : "result-low");

        resultBox.innerHTML = `
            <h5>Risk Assessment Result</h5>
            <p><strong>Risk Score:</strong> ${data.risk_score}</p>
            <p><strong>Risk Level:</strong> ${data.risk_level.toUpperCase()}</p>
        `;

        resultBox.style.display = "block";

    } catch (err) {
        errorBox.innerText =
            "Unable to reach the risk assessment service. Please try again later.";
        errorBox.style.display = "block";
    }
});

/*
===========================================
DARK MODE TOGGLE
===========================================
*/
document.querySelector(".dark-toggle").addEventListener("click", e => {
    document.body.classList.toggle("light-mode");
    e.target.textContent =
        document.body.classList.contains("light-mode") ? "ðŸŒ™" : "â˜€";
});
</script>

</body>
</html>
